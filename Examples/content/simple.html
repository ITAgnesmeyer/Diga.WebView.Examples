<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="codemirror-5.65.0/lib/codemirror.css" />
    <link rel="stylesheet" href="codemirror-5.65.0/addon/hint/show-hint.css" />
    <script src="codemirror-5.65.0/lib/codemirror.js"></script>
    <script src="codemirror-5.65.0/addon/hint/show-hint.js"></script>
    <script src="codemirror-5.65.0/addon/hint/xml-hint.js"></script>
    <script src="codemirror-5.65.0/addon/hint/html-hint.js"></script>
    <script src="codemirror-5.65.0/mode/xml/xml.js"></script>
    <script src="codemirror-5.65.0/mode/javascript/javascript.js"></script>
    <script src="codemirror-5.65.0/mode/css/css.js"></script>
    <script src="codemirror-5.65.0/mode/htmlmixed/htmlmixed.js"></script>

    <style>
      .CodeMirror {
        border: 1px solid black;
        font-size: 13px;
        height: 100%;
        
      }
      html,
      body {
        height: 100%;
        
        
      }

      .full-height {
        height: 100%;
        
      }
    </style>
  </head>
  <body>
    <div class="full-height">
      <button id="bnTest">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          fill="#5F6368"
        >
          <path
            d="M17.65 6.35A7.958 7.958 0 0 0 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0 1 12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"
          />
        </svg>
      </button>
      <div style="height: 100%" id="code" name="code"></div>
    </div>

    <script>

      function utf8_to_b64( str ) {
        return window.btoa(unescape(encodeURIComponent( str )));
      }
      function b64_to_utf8( str ) {
        return decodeURIComponent(escape(window.atob( str )));
      }

      var editor = CodeMirror(document.getElementById("code"), {
        mode: "text/html",
        extraKeys: { "Ctrl-Space": "autocomplete" },
        lineNumbers: true,
        value: document.documentElement.innerHTML,
      });

      function GetCode()
      {
        return editor.getValue();
      }

      function ParseString(str,type)
      {
        
        return val;
      }
      function TestSetCode()
      {
        let v = encodeURI( "&lt;script&gt;&lt;/script&gt;");
        
        SetCode(v);
      }
      function SetCode(value)
      {
        
        let str = b64_to_utf8(value);
        try
        {
          
          editor.setValue(str);
        }catch(ex)
        {
          alert("Error in SetCode:" + ex);
        }

        
      }
    </script>
  </body>
</html>
